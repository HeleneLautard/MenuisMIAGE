-- Base gestion planning
CREATE TABLE Calendrier (
  idCalendrier integer GENERATED BY DEFAULT AS IDENTITY, 
  dateHeure    timestamp NOT NULL, 
  PRIMARY KEY (idCalendrier));
CREATE TABLE DispoCommercial (
  CalendrieridCalendrier integer NOT NULL, 
  keyNumCommercial       integer NOT NULL, 
  statut                 smallint NOT NULL, 
  keyNumAffaire          integer, 
  PRIMARY KEY (CalendrieridCalendrier, 
  keyNumCommercial));
CREATE TABLE DispoPoseur (
  CalendrieridCalendrier integer NOT NULL, 
  keyNumPoseur           integer NOT NULL, 
  statut                 smallint NOT NULL, 
  keyNumAffaire          integer, 
  PRIMARY KEY (CalendrieridCalendrier, 
  keyNumPoseur));
ALTER TABLE DispoPoseur ADD CONSTRAINT FKDispoPoseu34556 FOREIGN KEY (CalendrieridCalendrier) REFERENCES Calendrier (idCalendrier);
ALTER TABLE DispoCommercial ADD CONSTRAINT FKDispoComme19693 FOREIGN KEY (CalendrieridCalendrier) REFERENCES Calendrier (idCalendrier);


-- Base gestion affaire
CREATE TABLE Affaire (
  numAffaire       integer GENERATED BY DEFAULT AS IDENTITY, 
  lieuPose         varchar(255) NOT NULL, 
  statut           varchar(255) NOT NULL, 
  keyNumCommercial integer, 
  keyNumCommande   integer, 
  keyNumPoseur     integer, 
  ClientnumClient  integer NOT NULL, 
  PRIMARY KEY (numAffaire));
CREATE TABLE Client (
  numClient integer GENERATED BY DEFAULT AS IDENTITY, 
  nom       varchar(255) NOT NULL, 
  prenom    varchar(255) NOT NULL, 
  mail      varchar(255) NOT NULL, 
  telephone varchar(10) NOT NULL, 
  adresseP  varchar(255) NOT NULL, 
  PRIMARY KEY (numClient));
CREATE UNIQUE INDEX Affaire_keyNumCommercial 
  ON Affaire (keyNumCommercial);
CREATE UNIQUE INDEX Affaire_keyNumCommande 
  ON Affaire (keyNumCommande);
CREATE UNIQUE INDEX Affaire_keyNumPoseur 
  ON Affaire (keyNumPoseur);
ALTER TABLE Affaire ADD CONSTRAINT FKAffaire963621 FOREIGN KEY (ClientnumClient) REFERENCES Client (numClient);

-- Base Gestion Achat
CREATE TABLE Commande (
  numCommande             integer GENERATED BY DEFAULT AS IDENTITY, 
  cotes                   varchar(255) NOT NULL, 
  montant                 integer NOT NULL, 
  keyNumAffaire           integer NOT NULL, 
  MenuiserienumMenuiserie integer NOT NULL, 
  PRIMARY KEY (numCommande));
CREATE TABLE Menuiserie (
  numMenuiserie integer GENERATED BY DEFAULT AS IDENTITY, 
  designation   varchar(255) NOT NULL, 
  fabricant     varchar(255) NOT NULL, 
  PRIMARY KEY (numMenuiserie));
CREATE UNIQUE INDEX Commande_keyNumAffaire 
  ON Commande (keyNumAffaire);
ALTER TABLE Commande ADD CONSTRAINT FKCommande262497 FOREIGN KEY (MenuiserienumMenuiserie) REFERENCES Menuiserie (numMenuiserie);

-- Base Gestion Comptable
CREATE TABLE Cheque (
  numCheque        integer GENERATED BY DEFAULT AS IDENTITY, 
  montant          integer NOT NULL, 
  statut           varchar(255) NOT NULL, 
  rangEncaissement varchar(255) NOT NULL, 
  keyNumAffaire    integer NOT NULL, 
  PRIMARY KEY (numCheque));
CREATE INDEX Cheque_keyNumAffaire 
  ON Cheque (keyNumAffaire);

-- Base gestion pose 
CREATE TABLE Poseur (
  numPoseur integer GENERATED BY DEFAULT AS IDENTITY, 
  nom       varchar(255) NOT NULL, 
  prenom    varchar(255) NOT NULL, 
  PRIMARY KEY (numPoseur));


-- Base gestion commerciale 
CREATE TABLE Commercial (
  numCommercial integer GENERATED BY DEFAULT AS IDENTITY, 
  nom           varchar(255) NOT NULL, 
  prenom        varchar(255) NOT NULL, 
  PRIMARY KEY (numCommercial));

